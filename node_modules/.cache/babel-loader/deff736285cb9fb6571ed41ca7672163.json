{"ast":null,"code":"import React,{useEffect}from'react';import*as d3 from'd3';import{layout,select,scaleLinear,extent}from\"d3\";var styleDefs=require(\"./bar.scss\");var width=600;//Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\nvar height=500;//Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\nvar DrawGrapho=function DrawGrapho(props){useEffect(function(){d3.select('.drawGrapho > *').remove();draw(props);},[props]);return/*#__PURE__*/React.createElement(\"div\",{className:\"drawGrapho\"});};var baseNodes=[{id:\"mammal\",group:0,label:\"Mammals\",level:1},{id:\"dog\",group:0,label:\"Dogs\",level:2},{id:\"cat\",group:0,label:\"Cats\",level:2},{id:\"fox\",group:0,label:\"Foxes\",level:2},{id:\"elk\",group:0,label:\"Elk\",level:2},{id:\"insect\",group:1,label:\"Insects\",level:1},{id:\"ant\",group:1,label:\"Ants\",level:2},{id:\"bee\",group:1,label:\"Bees\",level:2},{id:\"fish\",group:2,label:\"Fish\",level:1},{id:\"carp\",group:2,label:\"Carp\",level:2},{id:\"pike\",group:2,label:\"Pikes\",level:2}];var baseLinks=[{target:\"mammal\",source:\"dog\",strength:0.7},{target:\"mammal\",source:\"cat\",strength:0.7},{target:\"mammal\",source:\"fox\",strength:0.7},{target:\"mammal\",source:\"elk\",strength:0.7},{target:\"insect\",source:\"ant\",strength:0.7},{target:\"insect\",source:\"bee\",strength:0.7},{target:\"fish\",source:\"carp\",strength:0.7},{target:\"fish\",source:\"pike\",strength:0.7},{target:\"cat\",source:\"elk\",strength:0.1},{target:\"carp\",source:\"ant\",strength:0.1},{target:\"elk\",source:\"bee\",strength:0.1},{target:\"dog\",source:\"cat\",strength:0.1},{target:\"fox\",source:\"ant\",strength:0.1},{target:\"pike\",source:\"cat\",strength:0.1}];var nodes=[].concat(baseNodes);var links=[].concat(baseLinks);function getNeighbors(node){return baseLinks.reduce(function(neighbors,link){if(link.target.id===node.id){neighbors.push(link.source.id);}else if(link.source.id===node.id){neighbors.push(link.target.id);}return neighbors;},[node.id]);}function isNeighborLink(node,link){return link.target.id===node.id||link.source.id===node.id;}function getNodeColor(node,neighbors){if(Array.isArray(neighbors)&&neighbors.indexOf(node.id)>-1){return node.level===1?'blue':'green';}return node.level===1?'red':'gray';}function getLinkColor(node,link){return isNeighborLink(node,link)?'green':'#E5E5E5';}function getTextColor(node,neighbors){return Array.isArray(neighbors)&&neighbors.indexOf(node.id)>-1?'green':'black';}var draw=function draw(props){function getNodeColor(node){return node.level===1?'red':'gray';}var svg=d3.select(\".drawGrapho\").append(\"svg\").attr(\"width\",width).attr(\"height\",height);var linkElements,nodeElements,textElements;// we use svg groups to logically group the elements together\nvar linkGroup=svg.append('g').attr('class','links');var nodeGroup=svg.append('g').attr('class','nodes');var textGroup=svg.append('g').attr('class','texts');// we use this reference to select/deselect\n// after clicking the same element twice\nvar selectedId;// simulation setup with all forces\nvar linkForce=d3.forceLink().id(function(link){return link.id;}).strength(function(link){return link.strength;});var simulation=d3.forceSimulation().force('link',linkForce).force('charge',d3.forceManyBody().strength(-120)).force('center',d3.forceCenter(width/2,height/2));var dragDrop=d3.drag().on('start',function(node){node.fx=node.x;node.fy=node.y;}).on('drag',function(node){simulation.alphaTarget(0.7).restart();node.fx=d3.event.x;node.fy=d3.event.y;}).on('end',function(node){if(!d3.event.active){simulation.alphaTarget(0);}node.fx=null;node.fy=null;});// select node is called on every click\n// we either update the data according to the selection\n// or reset the data if the same node is clicked twice\nfunction selectNode(selectedNode){if(selectedId===selectedNode.id){selectedId=undefined;resetData();updateSimulation();}else{selectedId=selectedNode.id;updateData(selectedNode);updateSimulation();}var neighbors=getNeighbors(selectedNode);// we modify the styles to highlight selected nodes\nnodeElements.attr('fill',function(node){return getNodeColor(node,neighbors);});textElements.attr('fill',function(node){return getTextColor(node,neighbors);});linkElements.attr('stroke',function(link){return getLinkColor(selectedNode,link);});}// this helper simple adds all nodes and links\n// that are missing, to recreate the initial state\nfunction resetData(){var nodeIds=nodes.map(function(node){return node.id;});baseNodes.forEach(function(node){if(nodeIds.indexOf(node.id)===-1){nodes.push(node);}});links=baseLinks;}// diffing and mutating the data\nfunction updateData(selectedNode){var neighbors=getNeighbors(selectedNode);var newNodes=baseNodes.filter(function(node){return neighbors.indexOf(node.id)>-1||node.level===1;});var diff={removed:nodes.filter(function(node){return newNodes.indexOf(node)===-1;}),added:newNodes.filter(function(node){return nodes.indexOf(node)===-1;})};diff.removed.forEach(function(node){nodes.splice(nodes.indexOf(node),1);});diff.added.forEach(function(node){nodes.push(node);});links=baseLinks.filter(function(link){return link.target.id===selectedNode.id||link.source.id===selectedNode.id;});}function updateGraph(){// links\nlinkElements=linkGroup.selectAll('line').data(links,function(link){return link.target.id+link.source.id;});linkElements.exit().remove();var linkEnter=linkElements.enter().append('line').attr('stroke-width',1).attr('stroke','rgba(50, 50, 50, 0.2)');linkElements=linkEnter.merge(linkElements);// nodes\nnodeElements=nodeGroup.selectAll('circle').data(nodes,function(node){return node.id;});nodeElements.exit().remove();var nodeEnter=nodeElements.enter().append('circle').attr('r',10).attr('fill',function(node){return node.level===1?'red':'gray';}).call(dragDrop)// we link the selectNode method here\n// to update the graph on every click\n.on('click',selectNode);nodeElements=nodeEnter.merge(nodeElements);// texts\ntextElements=textGroup.selectAll('text').data(nodes,function(node){return node.id;});textElements.exit().remove();var textEnter=textElements.enter().append('text').text(function(node){return node.label;}).attr('font-size',15).attr('dx',15).attr('dy',4);textElements=textEnter.merge(textElements);}function updateSimulation(){updateGraph();simulation.nodes(nodes).on('tick',function(){nodeElements.attr('cx',function(node){return node.x;}).attr('cy',function(node){return node.y;});textElements.attr('x',function(node){return node.x;}).attr('y',function(node){return node.y;});linkElements.attr('x1',function(link){return link.source.x;}).attr('y1',function(link){return link.source.y;}).attr('x2',function(link){return link.target.x;}).attr('y2',function(link){return link.target.y;});});simulation.force('link').links(links);simulation.alphaTarget(0.7).restart();}// last but not least, we call updateSimulation\n// to trigger the initial render\nupdateSimulation();};export default DrawGrapho;","map":{"version":3,"sources":["/home/fabian/Documents/d3Js/networks/network-react/chart-d3js-react/src/drawGrapho.js"],"names":["React","useEffect","d3","layout","select","scaleLinear","extent","styleDefs","require","width","height","DrawGrapho","props","remove","draw","baseNodes","id","group","label","level","baseLinks","target","source","strength","nodes","links","getNeighbors","node","reduce","neighbors","link","push","isNeighborLink","getNodeColor","Array","isArray","indexOf","getLinkColor","getTextColor","svg","append","attr","linkElements","nodeElements","textElements","linkGroup","nodeGroup","textGroup","selectedId","linkForce","forceLink","simulation","forceSimulation","force","forceManyBody","forceCenter","dragDrop","drag","on","fx","x","fy","y","alphaTarget","restart","event","active","selectNode","selectedNode","undefined","resetData","updateSimulation","updateData","nodeIds","map","forEach","newNodes","filter","diff","removed","added","splice","updateGraph","selectAll","data","exit","linkEnter","enter","merge","nodeEnter","call","textEnter","text"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport * as d3 from 'd3';\nimport { layout, select, scaleLinear, extent } from \"d3\";\n\nconst styleDefs = require(\"./bar.scss\");\n\nconst width = 600 //Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\nconst height = 500 //Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n\nconst DrawGrapho = (props) => {\n  useEffect(() => {\n   d3.select('.drawGrapho > *').remove();\n   draw(props)\n },[props])\n  return <div className=\"drawGrapho\" />\n}\n\nvar baseNodes = [\n  { id: \"mammal\", group: 0, label: \"Mammals\", level: 1 },\n  { id: \"dog\"   , group: 0, label: \"Dogs\"   , level: 2 },\n  { id: \"cat\"   , group: 0, label: \"Cats\"   , level: 2 },\n  { id: \"fox\"   , group: 0, label: \"Foxes\"  , level: 2 },\n  { id: \"elk\"   , group: 0, label: \"Elk\"    , level: 2 },\n  { id: \"insect\", group: 1, label: \"Insects\", level: 1 },\n  { id: \"ant\"   , group: 1, label: \"Ants\"   , level: 2 },\n  { id: \"bee\"   , group: 1, label: \"Bees\"   , level: 2 },\n  { id: \"fish\"  , group: 2, label: \"Fish\"   , level: 1 },\n  { id: \"carp\"  , group: 2, label: \"Carp\"   , level: 2 },\n  { id: \"pike\"  , group: 2, label: \"Pikes\"  , level: 2 }\n]\n\nvar baseLinks = [\n\t{ target: \"mammal\", source: \"dog\" , strength: 0.7 },\n\t{ target: \"mammal\", source: \"cat\" , strength: 0.7 },\n  { target: \"mammal\", source: \"fox\" , strength: 0.7 },\n  { target: \"mammal\", source: \"elk\" , strength: 0.7 },\n  { target: \"insect\", source: \"ant\" , strength: 0.7 },\n  { target: \"insect\", source: \"bee\" , strength: 0.7 },\n  { target: \"fish\"  , source: \"carp\", strength: 0.7 },\n  { target: \"fish\"  , source: \"pike\", strength: 0.7 },\n  { target: \"cat\"   , source: \"elk\" , strength: 0.1 },\n  { target: \"carp\"  , source: \"ant\" , strength: 0.1 },\n  { target: \"elk\"   , source: \"bee\" , strength: 0.1 },\n  { target: \"dog\"   , source: \"cat\" , strength: 0.1 },\n  { target: \"fox\"   , source: \"ant\" , strength: 0.1 },\n\t{ target: \"pike\"  , source: \"cat\" , strength: 0.1 }\n]\n\nvar nodes = [...baseNodes]\nvar links = [...baseLinks]\n\nfunction getNeighbors(node) {\n  return baseLinks.reduce(function (neighbors, link) {\n      if (link.target.id === node.id) {\n        neighbors.push(link.source.id)\n      } else if (link.source.id === node.id) {\n        neighbors.push(link.target.id)\n      }\n      return neighbors\n    },\n    [node.id]\n  )\n}\n\nfunction isNeighborLink(node, link) {\n  return link.target.id === node.id || link.source.id === node.id\n}\n\nfunction getNodeColor(node, neighbors) {\n  if (Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1) {\n    return node.level === 1 ? 'blue' : 'green'\n  }\n\n  return node.level === 1 ? 'red' : 'gray'\n}\n\n\nfunction getLinkColor(node, link) {\n  return isNeighborLink(node, link) ? 'green' : '#E5E5E5'\n}\n\nfunction getTextColor(node, neighbors) {\n  return Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1 ? 'green' : 'black'\n}\n\n\nconst draw = (props) => {\n\n  function getNodeColor(node) {\n    return node.level === 1 ? 'red' : 'gray'\n  }\n\n  var svg = d3.select(\".drawGrapho\").append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height);\n\n  var linkElements,\n      nodeElements,\n      textElements\n\n  // we use svg groups to logically group the elements together\n  var linkGroup = svg.append('g').attr('class', 'links')\n  var nodeGroup = svg.append('g').attr('class', 'nodes')\n  var textGroup = svg.append('g').attr('class', 'texts')\n\n  // we use this reference to select/deselect\n  // after clicking the same element twice\n  var selectedId\n\n  // simulation setup with all forces\n  var linkForce = d3\n    .forceLink()\n    .id(function (link) { return link.id })\n    .strength(function (link) { return link.strength })\n\n  var simulation = d3\n    .forceSimulation()\n    .force('link', linkForce)\n    .force('charge', d3.forceManyBody().strength(-120))\n    .force('center', d3.forceCenter(width / 2, height / 2))\n\n  var dragDrop = d3.drag().on('start', function (node) {\n    node.fx = node.x\n    node.fy = node.y\n  }).on('drag', function (node) {\n    simulation.alphaTarget(0.7).restart()\n    node.fx = d3.event.x\n    node.fy = d3.event.y\n  }).on('end', function (node) {\n    if (!d3.event.active) {\n      simulation.alphaTarget(0)\n    }\n    node.fx = null\n    node.fy = null\n  })\n\n  // select node is called on every click\n  // we either update the data according to the selection\n  // or reset the data if the same node is clicked twice\n  function selectNode(selectedNode) {\n    if (selectedId === selectedNode.id) {\n      selectedId = undefined\n      resetData()\n      updateSimulation()\n    } else {\n      selectedId = selectedNode.id\n      updateData(selectedNode)\n      updateSimulation()\n    }\n\n    var neighbors = getNeighbors(selectedNode)\n\n    // we modify the styles to highlight selected nodes\n    nodeElements.attr('fill', function (node) { return getNodeColor(node, neighbors) })\n    textElements.attr('fill', function (node) { return getTextColor(node, neighbors) })\n    linkElements.attr('stroke', function (link) { return getLinkColor(selectedNode, link) })\n  }\n\n  // this helper simple adds all nodes and links\n  // that are missing, to recreate the initial state\n  function resetData() {\n    var nodeIds = nodes.map(function (node) { return node.id })\n\n    baseNodes.forEach(function (node) {\n      if (nodeIds.indexOf(node.id) === -1) {\n        nodes.push(node)\n      }\n    })\n\n    links = baseLinks\n  }\n\n  // diffing and mutating the data\n  function updateData(selectedNode) {\n    var neighbors = getNeighbors(selectedNode)\n    var newNodes = baseNodes.filter(function (node) {\n      return neighbors.indexOf(node.id) > -1 || node.level === 1\n    })\n\n    var diff = {\n      removed: nodes.filter(function (node) { return newNodes.indexOf(node) === -1 }),\n      added: newNodes.filter(function (node) { return nodes.indexOf(node) === -1 })\n    }\n\n    diff.removed.forEach(function (node) { nodes.splice(nodes.indexOf(node), 1) })\n    diff.added.forEach(function (node) { nodes.push(node) })\n\n    links = baseLinks.filter(function (link) {\n      return link.target.id === selectedNode.id || link.source.id === selectedNode.id\n    })\n  }\n\n  function updateGraph() {\n    // links\n    linkElements = linkGroup.selectAll('line')\n      .data(links, function (link) {\n        return link.target.id + link.source.id\n      })\n\n    linkElements.exit().remove()\n\n    var linkEnter = linkElements\n      .enter().append('line')\n      .attr('stroke-width', 1)\n      .attr('stroke', 'rgba(50, 50, 50, 0.2)')\n\n    linkElements = linkEnter.merge(linkElements)\n\n    // nodes\n    nodeElements = nodeGroup.selectAll('circle')\n      .data(nodes, function (node) { return node.id })\n\n    nodeElements.exit().remove()\n\n    var nodeEnter = nodeElements\n      .enter()\n      .append('circle')\n      .attr('r', 10)\n      .attr('fill', function (node) { return node.level === 1 ? 'red' : 'gray' })\n      .call(dragDrop)\n      // we link the selectNode method here\n      // to update the graph on every click\n      .on('click', selectNode)\n\n    nodeElements = nodeEnter.merge(nodeElements)\n\n    // texts\n    textElements = textGroup.selectAll('text')\n      .data(nodes, function (node) { return node.id })\n\n    textElements.exit().remove()\n\n    var textEnter = textElements\n      .enter()\n      .append('text')\n      .text(function (node) { return node.label })\n      .attr('font-size', 15)\n      .attr('dx', 15)\n      .attr('dy', 4)\n\n    textElements = textEnter.merge(textElements)\n  }\n\n  function updateSimulation() {\n    updateGraph()\n\n    simulation.nodes(nodes).on('tick', () => {\n      nodeElements\n        .attr('cx', function (node) { return node.x })\n        .attr('cy', function (node) { return node.y })\n      textElements\n        .attr('x', function (node) { return node.x })\n        .attr('y', function (node) { return node.y })\n      linkElements\n        .attr('x1', function (link) { return link.source.x })\n        .attr('y1', function (link) { return link.source.y })\n        .attr('x2', function (link) { return link.target.x })\n        .attr('y2', function (link) { return link.target.y })\n    })\n\n    simulation.force('link').links(links)\n    simulation.alphaTarget(0.7).restart()\n  }\n\n  // last but not least, we call updateSimulation\n  // to trigger the initial render\n  updateSimulation()\n\n\n}\nexport default DrawGrapho\n"]},"metadata":{},"sourceType":"module"}